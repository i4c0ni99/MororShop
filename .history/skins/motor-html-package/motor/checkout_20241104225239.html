<section class="main-banner mv-wrap">
  <div data-image-src="images/background/demo_bg_1920x1680.png" class="mv-banner-style-1 mv-bg-overlay-dark overlay-0-85 mv-parallax">
    <div class="page-name mv-caption-style-6">
      <div class="container">
        <div class="mv-title-style-9"><span class="main">Checkout</span></div>
      </div>
    </div>
  </div>
</section>
<!-- .main-banner-->
<section class="mv-main-body checkout-main mv-bg-gray mv-wrap">
  <div class="container">
    <form method="post" action="checkout.php"> 
      <div class="checkout-block block-billing-address mv-mb-50">
        <div class="mv-form-style-2 mv-box-shadow-gray-1">
          <div class="row">
            <div class="col-sm-6 col-billing-address">
              <div class="form-billing-address">
                <div class="form-header">
                  <div class="mv-title-style-13">
                    <div class="text-main">Indirizzo di spedizione</div>
                  </div>
                </div>
                <!-- .form-header-->
                <div class="form-body">
                  <div class="mv-form-group">
                    <h4><span>*</span>Indirizzi salvati:</h4>
                    <br>
                    <div class="table-responsive table-desi">
                      <table class="all-package coupon-table table table-striped">
                        <thead>
                          <tr>
                            <th>Scegli</th>
                            <th>Nome</th>
                            <th>Cognome</th>
                            <th>Cellulare</th>
                            <th>Provincia</th>
                            <th>Città</th>
                            <th>Indirizzo</th>
                            <th>CAP</th>
                          </tr>
                        </thead>
                        <tbody>
                          <[foreach]>
                          <tr data-row-id="<[id]>">
                            <td>
                              <input class="checkbox_animated check-it" id="select_adress" type="radio" name="address_list" value="<[id]>" required>
                            </td>
                            <td><[ADname]></td>
                            <td><[ADsurname]></td>
                            <td><[ADphone]></td>
                            <td><[ADprovince]></td>
                            <td><[ADcity]></td>
                            <td><[ADstreetAddress]></td>
                            <td><[ADcap]></td>
                          </tr>
                          <[/foreach]>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <hr>
                  <form class="needs-validation add-product-form" method="post" action="/MotorShop/checkout.php">
                    <div class="mv-form-group">
                      <h4>Aggiungi un nuovo indirizzo:</h4>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mv-label"> <strong class="text-uppercase">Nome <span class="mv-color-primary">*</span></strong></div>
                          <div class="mv-field">
                            <input type="text" id="name" name="name" minlength="2" required="true" class="mv-inputbox mv-inputbox-style-2"/>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mv-label"> <strong class="text-uppercase">Cognome <span class="mv-color-primary">*</span></strong></div>
                          <div class="mv-field">
                            <input type="text" id="surname" name="surname" minlength="2" required="true" class="mv-inputbox mv-inputbox-style-2"/>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="mv-form-group">
                      <div class="mv-label"> <strong class="text-uppercase">Provincia <span class="mv-color-primary">*</span></strong></div>
                      <div class="mv-field">
                        <input type="text" id="province" name="province" minlength="2" required="true" class="mv-inputbox mv-inputbox-style-2">
                      </div>
                    </div>
                    <div class="mv-form-group">
                      <div class="mv-label"> <strong class="text-uppercase">Città <span class="mv-color-primary">*</span></strong></div>
                      <div class="mv-field">
                        <input type="text" id="city" name="city" minlength="2" required="true" class="mv-inputbox mv-inputbox-style-2"/>
                      </div>
                    </div>
                    <div class="mv-form-group">
                      <div class="mv-label"> <strong class="text-uppercase">Indirizzo <span class="mv-color-primary">*</span></strong></div>
                      <div class="mv-field">
                        <input type="text" name="streetAddress" minlength="3" required="true" class="mv-inputbox mv-inputbox-style-2"/>
                      </div>
                    </div>
                    <div class="mv-form-group">
                      <div class="mv-label"> <strong class="text-uppercase">CAP <span class="mv-color-primary">*</span></strong></div>
                      <div class="mv-field">
                        <input type="text" id="cap" name="cap" pattern="[0-9]{5}" required="true" class="mv-inputbox mv-inputbox-style-2"/>
                      </div>
                    </div>
                    <div class="mv-form-group">
                      <div class="mv-label"> <strong class="text-uppercase">Cellulare <span class="mv-color-primary">*</span></strong></div>
                      <div class="mv-field">
                        <input type="text" id="phone" name="phone" pattern="[3]{1}[0-9]{9}" minlength="10" required="true" class="mv-inputbox mv-inputbox-style-2"/>
                      </div>
                    </div>
                    <div class="mv-form-group">
                      <button type="submit" name="add-address-button" class="mv-btn mv-btn-style-5">Aggiungi Indirizzo</button>
                    </div>
                  </form>
                </div>
                <!-- .form-body-->
              </div>
              <!-- .form-billing-address-->
            </div>
            <br>
            <hr>
            <br>
            <div class="col-sm-6 col-shipping-address">
              <div class="form-different-address">
                <div class="form-header">
                  <div class="mv-title-style-13">
                    <div class="text-main">Note spedizione</div>
                  </div>
                </div>
                <div class="mv-form-group">
                  <div class="mv-label"> <strong class="text-uppercase">Istruzioni per il corriere</strong></div>
                  <div class="mv-field">
                    <textarea id="details" name="order_details" rows="5" placeholder="Questo campo è facoltativo." data-mv-placeholder="Questo campo è facoltativo." class="mv-inputbox mv-inputbox-style-2 mv-resize-vertical"></textarea>
                  </div>
                </div>
                <!-- .form-body-->
              </div>
              <!-- .form-shipping-address-->
            </div>
          </div>
        </div>
      </div>
      <!-- .block-billing-address-->
      <div class="checkout-block block-coupon-code">
        <div class="row">

          <div class="col-xs-12 col-sm-12 col-md-8 col-coupon-code mv-mb-50">
            <div class="mv-well-style-2 mv-box-shadow-gray-1 mv-bg-white">
              <div class="well--header">
                <div class="mv-title-style-13">
                  <div class="text-main">Riepilogo ordine</div>
                </div>
              </div>
              <div class="well-2-body">
                <table class="mv-table-style-1">
                  <thead>
                    <tr>
                      <th class="text-uppercase">Prodotto</th>
                      <th class="text-uppercase">Quantità</th>
                      <th class="text-uppercase">Taglia</th>
                      <th class="text-uppercase">Colore</th>
                      <th class="text-uppercase">Prezzo</th>
                    </tr>
                  </thead>
                  <tbody>
                    <[foreach]>
                      <tr>
                        <td><[title]></td>
                        <td><[quantity]></td>
                        <td><[size]></td>
                        <td><[color]></td>
                        <td><[price]></td>
                      </tr>
                    <[/foreach]>
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="4" class="text-uppercase">Totale ordine:</td>
                      <td class="text-uppercase"><[total_price]></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>          
          
          <div class="col-xs-12 col-sm-12 col-md-4 col-cart-totals mv-mb-50">
            <div class="mv-well-style-2 mv-box-shadow-gray-1 mv-bg-white">
                <div class="well-2-header">
                    <div class="mv-title-style-13">
                        <div class="text-main">
                            Metodo di pagamento 
                            <span id="selected_payment" class="title-text"></span>
                        </div>
                    </div>
                </div>
                <div class="well-2-body">
                    <div class="mv-block-style-38">
                        <div class="block-38-list method-payment-list">
                            <div class="item">
                                <label class="block-38-header mv-btn mv-btn-style-4 btn-choose-method" onclick="selectPaymentMethod('Bonifico bancario')">
                                    <span class="block-38-visual-box"><span class="icon-checked"></span></span>
                                    <span class="block-38-title"><span class="title-text">Bonifico bancario</span></span>
                                    <span class="block-38-minus-plus fa fa-plus"></span>
                                </label>
                                <div class="block-38-body">
                                    <div class="block-38-content">
                                        Effettua il pagamento direttamente sul nostro conto bancario. Si prega di utilizzare il numero d'ordine come riferimento di pagamento. 
                                        Si noti che l'ordine non verrà spedito fino a quando i fondi non saranno ricevuti.
                                    </div>
                                </div>
                                <input type="radio" id="payment_method_bonifico" name="payment_method" value="Bonifico bancario" class="hidden">
                            </div>
                            <div class="item">
                                <label class="block-38-header mv-btn mv-btn-style-4 btn-choose-method" onclick="selectPaymentMethod('PayPal')">
                                    <span class="block-38-visual-box"><span class="icon-checked"></span></span>
                                    <span class="block-38-title"><span class="title-text">PayPal</span></span>
                                    <span class="block-38-minus-plus fa fa-plus"></span>
                                </label>
                                <div class="block-38-body">
                                    <div class="block-38-content">Paga tramite PayPal; puoi pagare con la tua carta di credito se non hai un account PayPal.</div>
                                </div>
                                <input type="radio" id="payment_method_paypal" name="payment_method" value="PayPal" class="hidden">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        </div>
      </div>
      <div class="checkout-block block-confirm-order mv-mb-50">
        <div class="row">
          <div class="col-xs-10 col-sm-10 col-md-3 col-confirm-order mv-mb-50">
            <div class="mv-well-style-2 mv-box-shadow-gray-1 mv-bg-white">
              <div class="well-2-body">
                <button onclick="sendOrder()" class="mv-btn mv-btn-style-5 btn-5-h-45 responsive-btn-5-type-1 btn-confirm-order">Conferma ordine</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</section>

<script>
    
    let address = 1;

    document.querySelectorAll('input[name="address_list"]').forEach(radio => {
        radio.addEventListener('change', function() {
            // Ottieni il valore selezionato
            const selectedValue = this.value; // ID dell'indirizzo
            
            // Ottieni il nome e gli altri dati dalla riga corrispondente
            address = selectedValue;
            
            console.log(rowData); // Stampa i dati nella console
            // Puoi fare altre operazioni con rowData qui
        });
    });

    
        function selectPaymentMethod(method) {
            // Aggiorna il testo del metodo di pagamento selezionato
            document.getElementById('selected_payment').textContent = method;
            
            // Seleziona il radio button corrispondente
            const radioButton = document.querySelector(`input[value="${method}"]`);
            if (radioButton) {
                radioButton.checked = true;
            }
        }

  function sendOrder(){
    //const address = document.getElementById('select_adress').value
    const payment_method = document.getElementById('selected_payment').textContent
    
    const details = document.getElementById('details').value
    
    if(payment_method !== null) {

    $.ajax({
        url: "checkout.php", // Endpoint che verrà chiamato
        method: "POST",
        data: { 
            address_list : address,
            payment_method : payment_method,
            details : details
         }, // I parametri verranno aggiunti all'URL
        success: function (response) {

        console.log("aggiornato con succcesso")
        window.location.href="/../MotorShop/customer-dashboard.php";
        },
        error: function () {
            
          alert("Errore durante la connessione al server.");
        },
      });
      
    } else {

  }
</script>
